<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sharing data between processes with SQLite - mike.depalatis.net</title>
<link rel="stylesheet" href="/css/inter.css">
<link rel="stylesheet" href="/css/new.css">
<link rel="stylesheet" href="/css/codehilite.css">
</head>
<body>
<header>
<h1>mike.depalatis.net</h1>
<nav>
<a href="/index.html">Home</a>
/
<a href="/blog/index.html">Articles</a>
/
<a href="/resources.html">Resources</a>
</nav>
</header>


<h1>Sharing data between processes with SQLite</h1>
<p>Because of the global interpreter lock in CPython, it is sometimes beneficial to
use separate processes to handle different tasks. This can pose a challenge for
sharing data: it's generally best to avoid sharing memory between processes for
reasons of safety<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. One common approach is to use pipes, queues, or sockets
to communicate data from one process to another. This approach works quite well,
but it can be a bit cumbersome to get right when there are more than two
processes involved and you just need to share a small amount of infrequently
changing data (say some configuration settings that are loaded after worker
processes have already been spawned). In such cases, using a file that each
process can read is a simple solution, but may have problems if reading and
writing happen simultaneously. Thankfully, <a href="https://sqlite.org/">SQLite</a> can handle this situation
easily!</p>
<p>I have created a small module (<a href="https://pypi.python.org/pypi/permadict">Permadict</a>) which utilizes SQLite to persist
arbitrary (picklable) Python objects to a SQLite database using a dict-like
interface. This is not
a
<a href="https://pypi.python.org/pypi/sqldict/0.5.2">new</a> <a href="https://dataset.readthedocs.io/en/latest/">idea</a>,
but it was fun and simple to utilize only the Python standard library to
accomplish this. A basic usage example:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">permadict</span> <span class="kn">import</span> <span class="n">Permadict</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Permadict</span><span class="p">(</span><span class="s2">&quot;db.sqlite&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">])</span>
<span class="n">value</span>
</code></pre></div>

<p>Because context managers are great, you can also use permadicts that way:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">Permadict</span><span class="p">(</span><span class="s2">&quot;db.sqlite&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">d</span><span class="p">[</span><span class="s2">&quot;something&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.2345</span>
<span class="o">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">Permadict</span><span class="p">(</span><span class="s2">&quot;db.sqlite&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
<span class="o">...</span>     <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;something&quot;</span><span class="p">])</span>
<span class="o">...</span>
<span class="mf">1.2345</span>
</code></pre></div>

<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>Of course, Python allows you to share memory among processes by using a
<a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing-managers">manager</a>,
but this is not always possible depending on the specific use case.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>

</body>
</html>
