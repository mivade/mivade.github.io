<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importing one Mercurial repository into another - mike.depalatis.net</title>
<link rel="stylesheet" href="/css/inter.css">
<link rel="stylesheet" href="/css/new.css">
<link rel="stylesheet" href="/css/codehilite.css">
</head>
<body>
<header>
<h1>mike.depalatis.net</h1>
<nav>
<a href="/index.html">Home</a>
/
<a href="/blog/index.html">Articles</a>
/
<a href="/resources.html">Resources</a>
</nav>
</header>


<h1>Importing one Mercurial repository into another</h1>
<p>In the
<a href="http://phys.au.dk/forskning/forskningsomraader/amo/the-ion-trap-group/">ion trap group</a>,
we usually use <a href="https://www.mercurial-scm.org/">Mercurial</a> for version controlling software we write
for experimental control, data analysis, and so on. This post outlines
how to import the full history of one repository into another. This
can be useful for cases where it makes sense to move a sub-project
directly into its parent, for example.</p>
<h2>Convert the soon-to-be child repository</h2>
<p>With the Mercurial <code>convert</code> extension, you can rename branches, move,
and filter files. As an example, say we have a repo with only the
<code>default</code> branch which is to be imported into a super-repository.</p>
<p>For starters, we will want all our files in the child repo to be in a
subdirectory of the parent repo and not include the child's
<code>.hgignore</code>. To do this, create a file <code>filemap.txt</code> with the
following contents:</p>
<div class="codehilite"><pre><span></span><code>rename . child
exclude .hgignore
</code></pre></div>

<p>The first line will move all files in the repo's top level into a
directory named <code>child</code>.</p>
<p>Next, optionally create a <code>branchmap.txt</code> file for renaming the
<code>default</code> branch to something else:</p>
<div class="codehilite"><pre><span></span><code>default child-repo
</code></pre></div>

<p>Now convert:</p>
<div class="codehilite"><pre><span></span><code>hg convert --filemap branchmap.txt --branchmap branchmap.txt child/ converted/
</code></pre></div>

<h2>Pull in the converted repository</h2>
<p>From the parent repo:</p>
<div class="codehilite"><pre><span></span><code>hg pull -f ../converted
</code></pre></div>

<p>Ensure the child commits are in the draft phase with:</p>
<div class="codehilite"><pre><span></span><code>hg phase -f --draft -r &lt;first&gt;:&lt;last&gt;
</code></pre></div>

<h2>Rebase as appropriate</h2>
<div class="codehilite"><pre><span></span><code>hg rebase -s &lt;child rev&gt; -d &lt;parent rev&gt;
</code></pre></div>

<p>To keep the child's changed branch name, use the <code>--keepbranches</code>
option.</p>
<h2>References</h2>
<ul>
<li>https://mercurial.selenic.com/wiki/ConvertExtension</li>
<li>https://mercurial.selenic.com/wiki/Phases</li>
<li>https://mercurial.selenic.com/wiki/RebaseExtension</li>
<li>https://stackoverflow.com/questions/3214717/how-can-i-import-a-mercurial-repo-including-history-into-another-mercurial-rep</li>
<li>https://stackoverflow.com/questions/3338672/mercurial-convert-clones-to-branches</li>
</ul>

</body>
</html>
